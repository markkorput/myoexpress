// Generated by CoffeeScript 1.6.3
(function() {
  var App, Targets,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Targets = (function() {
    function Targets(_opts) {
      this.options = _opts;
    }

    Targets.prototype.position = function() {
      return this._position || (this._position = this.options.position || new THREE.Vector3(0, 0, 0));
    };

    Targets.prototype.dimensions = function() {
      return this._dimensions || (this._dimensions = this.options.dimensions || new THREE.Vector2(10, 10));
    };

    Targets.prototype.cols = function() {
      return this.dimensions().x;
    };

    Targets.prototype.rows = function() {
      return this.dimensions().y;
    };

    Targets.prototype.cell_size = function() {
      return this._cell_size || (this._cell_size = this.options.cell_size || new THREE.Vector3(200, 200, 200));
    };

    Targets.prototype.spacing = function() {
      return this._spacing || (this._spacing = this.options.spacing || this.cell_size());
    };

    Targets.prototype.geometry = function() {
      return this._geometry || (this._geometry = this.options.geometry || new THREE.CubeGeometry(this.cell_size().x, this.cell_size().y, this.cell_size().z));
    };

    Targets.prototype.materials = function() {
      return this.options.materials || this._materials || (this._materials = [
        new THREE.MeshBasicMaterial({
          color: 0xffffff
        })
      ]);
    };

    Targets.prototype.random_material = function() {
      return this.materials()[Math.floor(Math.random() * this.materials().length)];
    };

    Targets.prototype.boxes = function() {
      return this._boxes || (this._boxes = this.generateBoxes());
    };

    Targets.prototype.generateBoxes = function() {
      var boxes, mesh, x, y, _i, _j, _ref, _ref1;
      boxes = [];
      for (y = _i = 0, _ref = this.rows() - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; y = 0 <= _ref ? ++_i : --_i) {
        for (x = _j = 0, _ref1 = this.cols() - 1; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; x = 0 <= _ref1 ? ++_j : --_j) {
          mesh = new THREE.Mesh(this.geometry(), this.random_material());
          mesh.position.copy(this.position());
          mesh.position.add(new THREE.Vector3(x * this.spacing().x, y * this.spacing().y, 0));
          boxes.push(mesh);
        }
      }
      return boxes;
    };

    Targets.prototype.addBoxesToScene = function(scene) {
      var box, _i, _len, _ref, _results;
      _ref = this.boxes();
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        box = _ref[_i];
        _results.push(scene.add(box));
      }
      return _results;
    };

    Targets.prototype.getBoxXY = function(x, y) {
      return this.boxes()[this.cols() * y + x];
    };

    Targets.prototype.randomBox = function() {
      return this.boxes()[Math.floor(Math.random() * this.boxes().length)];
    };

    Targets.prototype.reset = function() {
      var box, x, y, _i, _ref, _results;
      console.log("Grid resetting");
      _results = [];
      for (y = _i = 0, _ref = this.rows() - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; y = 0 <= _ref ? ++_i : --_i) {
        _results.push((function() {
          var _j, _ref1, _results1;
          _results1 = [];
          for (x = _j = 0, _ref1 = this.cols() - 1; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; x = 0 <= _ref1 ? ++_j : --_j) {
            box = this.getBoxXY(x, y);
            box.rotation.x = 0;
            box.rotation.y = 0;
            box.rotation.z = 0;
            box.position.copy(this.position());
            _results1.push(box.position.add(new THREE.Vector3(x * this.spacing().x, y * this.spacing().y, 0)));
          }
          return _results1;
        }).call(this));
      }
      return _results;
    };

    return Targets;

  })();

  App = (function() {
    function App() {
      this._keyDown = __bind(this._keyDown, this);
    }

    App.prototype.init = function() {
      this.scene = this.createScene();
      this.initVfx();
      this.myoManager = new MyoManager();
      this.recorder = new MyoRecorder();
      this.recorder.setup({
        myo_manager: this.myoManager
      });
      this.visualizer = new MyoVisualizer({
        myo_recorder: this.recorder,
        scene: this.scene
      });
      this.clock = new THREE.Clock();
      this.controls = new THREE.TrackballControls(this.camera, this.renderer.domElement);
      return $(window).on('keydown', this._keyDown).mousemove(this._mouseMove);
    };

    App.prototype.update = function() {
      if (this.paused) {
        return;
      }
      return this.controls.update(this.clock.getDelta());
    };

    App.prototype.draw = function() {
      return this.renderer.render(this.scene, this.camera);
    };

    App.prototype.initVfx = function() {
      this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
      this.camera.position.z = 500;
      this.renderer = new THREE.WebGLRenderer({
        preserveDrawingBuffer: true
      });
      this.renderer.setSize(window.innerWidth, window.innerHeight);
      return jQuery('body').append(this.renderer.domElement);
    };

    App.prototype.createScene = function() {
      var scene;
      scene = new THREE.Scene();
      return scene;
    };

    App.prototype._resize = function() {
      return console.log('TODO; _resize');
    };

    App.prototype._keyDown = function(e) {
      console.log('keycode: ' + e.keyCode);
      if (e.keyCode === 32) {
        return this.recorder.record();
      }
    };

    return App;

  })();

  jQuery(document).ready(function() {
    window.drawFrame = function() {
      requestAnimationFrame(drawFrame);
      app.update();
      return app.draw();
    };
    window.app = new App();
    window.app.init();
    window.drawFrame();
    return console.log('page loaded ok');
  });

}).call(this);
