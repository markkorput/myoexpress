// Generated by CoffeeScript 1.6.3
(function() {
  this.MyoVisualizer = Backbone.Model.extend({
    initialize: function() {
      var _this = this;
      this.scene = this.get('scene');
      this.myo_recorder = this.get('myo_recorder');
      this.meshes = [];
      this.passiveColor = new THREE.Color(0x0000aa);
      this.activeColor = new THREE.Color(0xffffff);
      this.myo_recorder.on('add', function(myo_record) {
        var geometry, material, mesh, orientation;
        orientation = myo_record.get('orientation');
        if (!orientation) {
          return;
        }
        geometry = new THREE.SphereGeometry(50, 10, 10);
        material = new THREE.LineBasicMaterial();
        material.color = _this.activeColor;
        mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(orientation.x, orientation.y, orientation.z);
        mesh.position.multiply(new THREE.Vector3(1000, 1000, 1000));
        mesh.myo_record = myo_record;
        _this.meshes.push(mesh);
        _this.scene.add(mesh);
        return myo_record.on('remove', function(model) {
          mesh = _this._meshForRecord(model);
          _this.scene.remove(mesh);
          return _this.meshes = _.without(_this.meshes, model);
        });
      });
      return this.on('change:highlight', function(obj, value, attr) {
        return _.each(_this.meshes, function(mesh) {
          mesh.material.color = _this.passiveColor;
          if (_.contains(_.flatten([value]), mesh.myo_record.get('target'))) {
            return mesh.material.color = _this.activeColor;
          }
        });
      });
    },
    _meshForRecord: function(record) {
      return _.find(this.meshes, function(mesh) {
        return mesh.myo_record === record;
      });
    }
  });

}).call(this);
